Provisionamento de Inst√¢ncia EC2 com Terraform e Configura√ß√£o com Ansible

Este guia oferece um passo a passo para provisionar uma inst√¢ncia EC2 na AWS utilizando Terraform e prepar√°-la usando Ansible. Antes de come√ßar, assegure-se de que o ambiente AWS esteja configurado corretamente.

Configura√ß√£o do Provedor AWS

Antes de tudo, √© necess√°rio configurar o provedor AWS. Consulte a documenta√ß√£o oficial da Terraform para detalhes e exemplos de configura√ß√£o.

Ap√≥s obter as configura√ß√µes desejadas, inicialize o projeto com o comando:

shell
Copy code
terraform init
Este comando baixa os plugins necess√°rios e prepara o ambiente para criar e gerenciar recursos de infraestrutura. Certifique-se de que os plugins est√£o atualizados; voc√™ pode encontr√°-los no arquivo .terraform.lock.hcl.

Provisionamento da Inst√¢ncia EC2

No arquivo instances.tf, voc√™ encontrar√° a configura√ß√£o para uma inst√¢ncia Amazon Linux 2023 AMI 64-bit. Ele tamb√©m inclui um script bash que ser√° executado durante a inicializa√ß√£o da inst√¢ncia, criando diret√≥rios espec√≠ficos na pasta /home/ubuntu.

Ap√≥s definir as configura√ß√µes, utilize o comando terraform plan para visualizar as mudan√ßas planejadas na infraestrutura antes de aplic√°-las. Este comando √© crucial para entender as altera√ß√µes que ser√£o feitas.

shell
Copy code
terraform plan
Ap√≥s revisar o plano, aplique as configura√ß√µes com o comando:

shell
Copy code
terraform apply
Este comando implementa as altera√ß√µes e provisiona a m√°quina na AWS.

Configura√ß√£o e Gerenciamento com Ansible

Ap√≥s a cria√ß√£o da VM, use Ansible para configur√°-la. Dois arquivos s√£o essenciais para este processo:

hosts.yml
Este arquivo de invent√°rio do Ansible lista os hosts nos quais voc√™ deseja executar tarefas. Certifique-se de manter a indenta√ß√£o correta de acordo com a documenta√ß√£o do Ansible.

yaml
Copy code
---
all:
  hosts:
    ec2-instance:
      ansible_host: <IP_DA_INSTANCIA>
      ansible_user: ubuntu
      ansible_ssh_private_key_file: /caminho/para/iac_code_key.pem
playbook.yml
Este arquivo de playbook do Ansible cont√©m tarefas que ser√£o executadas nos hosts listados no arquivo de invent√°rio.

yaml
Copy code
---
- name: Configura√ß√£o da Inst√¢ncia EC2
  hosts: ec2-instance
  become: yes
  tasks:
    - name: Atualizar cache do apt
      become: yes
      apt:
        update_cache: yes

    - name: Instalar pacotes necess√°rios
      become: yes
      apt:
        name: python3
        state: present
Finalmente, execute o playbook com o seguinte comando:

shell
Copy code
ansible-playbook -i hosts.yml playbook.yml
Agora, sua inst√¢ncia EC2 est√° configurada e pronta para uso.

‚å®Ô∏è com ‚ù§Ô∏è por Seu Nome üòä